function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-Oct-2016 17:27:12.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx60 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx9 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0.1875;-84.8125;-176.3125;-12.64;-10.77;-6.63;0.6875;-84.3125;-171.0625;-14.03;-15.75;-15.48;0;-86;-165.625;-25.58;-30.52;-35.66;0.0625;-86.75;-175.9375;-21.97;-25.86;-42.33;0.0625;-87.625;-176.875;-16.06;-23.64;-44.65;0.125;-89.5625;-179.875;-17.05;-25.72;-42.46;0;-87.9375;-178.875;-14.29;-28.91;-43.54;0;-88.6875;-178.6875;-13.09;-18.37;-35.77;0.1875;-87.875;-178.5;-10.51;-17.61;-25.88;0.125;-87.625;-178.1875;-5.94;-8.34;-7.99];
x1_step1.gain = [0.00556134862704206;0.0129764801297648;0.00564473452107956;0.0812017864393017;0.0854335753951303;0.0754716981132075;0.00557006092254134;0.0128102481985588;0.00571734857959621;0.0472813238770686;0.0571102227298687;0.0428540818512963;0.00556038227628149;0.012573673870334;0.00580656868082018;0.0336530371866061;0.0419287211740042;0.0303536196691455;0.00556231531374935;0.0125293657008614;0.00563876651982379;0.04;0.0440431622990531;0.0276204944068499;0.00555941626129256;0.0125097732603597;0.00562587904360056;0.0374181478016838;0.0454855583352286;0.0259437021662991;0.00556424969570509;0.0123934934159566;0.00558074642483432;0.0337325012649688;0.0439463854098;0.027311211252219;0.00556134862704206;0.0125441003528028;0.00558269364968597;0.0351246926589392;0.0355808574986657;0.0270160745643658;0.00557006092254134;0.0124513618677043;0.00560224089635854;0.0382409177820268;0.0476871721506915;0.0299625468164794;0.00555941626129256;0.0125097732603597;0.00559832050384885;0.0363438124659277;0.0485201358563804;0.0345901072293324;0.00557103064066852;0.0125490196078431;0.00560714911512178;0.0438692695766616;0.0906207521522429;0.0518806744487678];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.63335271487260769;2.57028865453508;1.3931995151789256;-0.95722338289313535;2.2099364562263495;-1.3242308404684047;-0.32496503031560059;1.2522659779632226;-0.29027773535964041;0.28751419661450583;1.0962629697465434;0.25372219390044964;1.0531828604428828;-1.1802963133726365;0.34399488369449727;0.75685262955055987;-1.3855032045094282;-0.9479069374502207;-0.70279771058205509;-1.3357549342490045];
IW1_1 = [0.12295198723301033 0.46070170430349278 -0.98049786535431471 0.34222547672233489 1.0690943577751348 -0.62424926245036361 0.032877592678603886 0.73018625176566454 -0.38898726597281014 -0.25019310161162533 1.5901805184069022 -1.6154599851621316 -0.35772103149399542 0.2076694970621582 -0.85158958006045082 -0.083751336376505461 0.50538814630415141 -1.1131578477710624 -0.31323144267738212 0.18860754684153105 -0.62034754725316277 -0.081110144621008948 -0.26956444380556716 -1.3813035026093057 0.26596802922566037 -0.19958824332381772 -0.518599881121388 -0.36980457253039256 -0.39794624687507801 -0.27538697910360743 0.28583663818146171 0.14872140042473747 -0.055554607812175909 0.10184535770117888 -1.0810755355356219 -0.01784734391677471 -0.10376559851966306 0.38259090157125286 -0.139838157232339 0.24708733013732564 -1.2734005156362975 0.80785998951499438 0.30277721426148596 0.54613081589881818 -0.15218048969534487 0.29751747390097166 -1.4021740510478657 -0.027495295505531519 -0.21570327754884133 0.86179930193409793 -0.44736492008413387 0.28268308695717237 -0.21137691483108048 -0.27107113658776144 0.24747532143117101 0.95151498683708546 -0.12815703100182343 -0.31289528764329155 0.052900541894987739 -0.50154060975758818;-0.17783256381437107 0.24136298500890449 -0.45201244149586361 -1.6530349246088403 1.0306905345057662 0.31372052013652701 0.30289258941197394 -0.22906913037555954 -1.4306547676109791 -2.0004243022370303 0.49706149791830223 1.0947491038016053 0.2095343041166399 -0.81048636702110266 -0.39291761618645932 -1.1701111501708263 0.21975297660396709 0.22091186173927352 0.17649885798129483 -0.61840776018862853 -0.024311581694250885 -0.49622414090394634 -0.21761269223673912 0.26968165933320609 -0.27708180521184728 -0.29515867870442924 0.62054713967672948 -0.38230769239273066 -0.30940295992689554 0.27544335229893158 -0.25615213813365173 -0.34833592039649935 0.72369896972898107 1.6849307874153856 -0.11277567539341923 0.17410935304923217 -0.047381833549379346 -0.54449438263258687 0.57180277642111221 2.3801362310075871 -0.40792822563956221 -0.23196797285935286 0.080866213942312831 0.16601197762301678 0.62811529671844302 2.2690046970136075 -0.21549580835849416 -0.054126031139751007 -0.26568065159656712 0.23336047545249317 0.57304341830484062 0.72238365072617761 0.22486637993852565 -0.3555731904100371 -0.011975488705667968 0.11614653717601292 0.049122676746287432 -0.70016323737683694 0.33007760755639304 -0.68357480600407206;0.11974055330899686 -0.52754101851848545 0.37376016337950768 -0.079337790245256404 0.65165436021555523 -0.20345543789328918 0.35027862541395349 -0.059092088788786426 0.58568338964538391 0.60756166702662695 0.23096259415346918 -0.0097015633077104212 0.30220285536360181 -0.17862960010973947 -0.36359799103925106 0.1115546079080163 -0.21161628792101739 -0.4043799786144337 0.013482939297017668 -0.29871619427433865 -0.11257762389014771 0.15779693336460113 0.18647402861272372 -0.18239899392469203 0.25654096303807589 -0.24022968963639382 -0.016213028958429316 0.3680569369254878 0.10121116739179026 -0.10293402185872796 0.28645306820677363 -0.18870431722738787 0.15965552100595115 -0.0031716864259549848 -0.29998433068736863 0.47488602568878818 0.43239859412037868 -0.1041516823196585 -0.16155772494941112 -0.073093097710650409 -0.81102814201723028 0.46317014428203723 0.52223182863019313 -0.43160012710584839 0.088790754795314702 -0.30553131054659871 -0.54526346582580609 -0.048913411650691609 0.31946471999692055 -0.16636693057789578 0.074286424838036477 -0.078828331858904963 -0.1126112597576229 0.060654899732326309 0.19996550231431001 -0.08664370627035009 -0.18666143942433139 -0.34958362783783675 0.019480424339686622 0.08029061428867465;0.046791648632311021 -0.077626867965207527 -1.0774509877687315 1.697165959215968 -1.4680342958787718 -0.69536342792622774 -0.38224717083962012 -0.2193343764442367 -0.56422810159954806 1.6887314224180283 -1.3938544291990096 -1.2215552396454379 -0.4527008487965799 -0.5871501915088041 -0.90796170355129846 1.5586631383979328 -0.69292728661216407 -0.94962936128482378 -0.041355479452173959 -0.79556899908623346 0.093483575550257811 1.3079602791324783 -0.45896225720448969 -0.23176969493923566 0.18806204773957041 -1.3072440632319653 0.15441159831999532 1.0924048346597899 -0.38788839616298998 0.36733256716466439 0.22626576728448528 -1.1093790968166075 0.51206574841654606 0.062106302413015575 0.20063675524138422 -0.1259957922385454 -0.032576070795230248 -0.36422055442357998 0.69974049111384573 -0.24275255307604904 0.21899070986716063 0.069937527611820843 -0.22436913265171404 0.61980154869811621 0.2294116704845838 -0.31885366629092343 0.60589863588130144 -0.25918490938195071 -0.10135486983477066 1.6077194974437259 0.93176764538702728 -0.58345964194852662 0.4799078601425526 0.76914977016336705 0.32316032109210713 1.9288273773010502 0.77553410038105108 -0.69771650296640331 -0.53140882849054305 0.66595006537135393;0.10934690274160511 0.72638562824184005 0.66379244836344542 -0.90002221088273082 -1.8990782926213998 -0.055544307970552209 0.24640185944069071 0.12965648688617135 1.0522148944275844 -0.7890966112646054 -1.5696782194777186 -0.46987063684422881 0.43044699336871056 -0.45021802775812014 1.4410777572643243 0.010985652221263621 0.42505872240576492 -1.136987364085525 0.020045792150830098 -0.99223559263650196 0.64116084292316167 0.22931384858016016 -0.86143233476346204 -0.21582255292132357 -0.26780598969794889 -0.42518926698699588 -0.50615713608962076 0.069794833417778326 -0.097571217116821735 0.54519861435356931 -0.46706221013671695 -0.11264046849446413 -1.174841994674199 1.3493472335267345 -0.13014217770871025 0.33022518092066794 0.15670785130240178 0.4480735175116739 -0.75091666656665068 1.8237516424125115 0.22627530103306265 -0.44360716460532951 0.13195742873494928 0.34005104299797162 -0.81715996434551941 1.7266782997847105 0.021110341883795312 -0.91295673035363234 -0.17157010801005368 0.18458936816889857 -0.57655502555033977 1.4112047951906579 0.27643520355040246 -0.63683134089725679 -0.10007632526452213 0.438634313456297 -0.52986347277355428 0.53069583095773287 -0.049732184039879251 -0.45013429772771624;0.20207221118953983 -0.020773211903337897 -0.85583664705476181 -0.289594071781207 -0.62482281272820006 0.55360723979657955 -0.50188084610161965 0.092506776201330465 -0.62621247271880576 -0.26732554279244225 -1.6361319170478437 1.6951459887115117 0.24050162932668986 -0.10711956491832787 -0.46001070331048416 -0.029203301956905417 -0.58822621969171296 1.5581981670294729 -0.26180148321305108 0.10261076337986132 -0.29904449019967766 -0.55522204059792013 -0.46569926069137346 1.1133065672410145 0.024728956523991284 -0.2314138043854746 0.041095892780347573 0.23690451386006905 -0.14174827498935297 0.24167960565771326 0.23532488870734553 -0.69208679620221403 -0.020304172490810547 -0.43658480580778436 0.87834746550016185 -0.22307755792614933 -0.25077860314944289 0.023408816618048715 -0.11085981061284554 -0.74750815779626623 1.0184130171310304 -0.72691931068720295 0.068247885855704987 -0.3344180394842266 -0.086420770670506089 -0.89937644474834533 1.1961017656554318 -0.52735124285919566 -0.25570495547819649 -0.15503607049772217 -0.34053801514729926 -0.52782577254813756 1.086687825854727 0.08315343889868522 0.32156238761177935 -0.35519323567042776 0.010004215460194527 -0.78310892311053748 -0.030266168245823767 -0.13176392383392613;0.40625374076503751 -0.34362301250679594 -0.99330514131419712 0.86716351137693526 1.1566561432422584 -0.91858718499745451 -0.10325794450449247 -0.38080641064144088 -1.5256982154530394 0.6943707295715259 0.077501812044828117 -1.1759806843748479 -0.18721961430234102 -0.74168661794426716 -1.1282935230736706 0.65542883732291324 -0.36309811419791671 -0.96796925274209877 0.53096762260044905 -0.22201313681536378 0.42831596803228827 -0.020866385720834022 -0.26890122432842184 -0.14205674674328406 0.50354460969314097 -0.63026439757298069 0.5714902951038946 -0.0803394475763375 -0.3859109531567621 -0.33370849032587757 -0.2453974471123774 -0.29289059012117608 0.69268935512317964 -0.1085458187893463 -0.1907092530602032 -0.0053046672428541802 -0.59552220291784808 0.20851787446526299 0.49850172898414125 0.11946328725505345 -0.049905539683137344 0.26430085855305419 0.013472135658234257 0.27773788962478391 0.4262064745165966 0.17288256772748151 0.53977085280679715 0.67668544954194754 -0.36673143103473682 1.2730758391901114 0.44358471472654537 0.18288988018541674 0.93192361840737459 0.72529551777334977 -0.36142750131573254 1.4091189642949478 0.23175494338437549 -0.44088783897668166 0.15658856679255601 -0.067298543407714309;-0.31181454750216425 -0.40273269686823049 0.53660153410826505 0.51775309114732715 0.67640153163167149 -0.33594341432099906 0.21149521241147998 -0.57652986715348031 0.49733576878170249 0.35746252015288305 0.48450912226952447 -0.45534757911819845 0.26926648976307782 0.028084278146531305 -0.0097211403572354596 0.055931706817222399 0.3333057688188335 -0.57093942021951916 -0.20248537224709659 0.17245069905479993 0.24835901539326191 0.91789849082654262 0.36522891170833582 -0.48845850191908846 -0.060853022903626923 0.50704486094078649 -0.092430648999143647 0.31440456514033505 0.1408075965710924 -0.0194006250794466 -0.26700549173756083 0.30786556405543214 0.035745215094822071 0.51483534559462107 -0.58096336251833547 0.50985655598869428 0.068810490849200101 0.51434274756342591 0.28158099989201468 0.67659701780696313 -0.52505140637001468 0.51751750853916278 -0.47581541183804377 0.028837340363974454 -0.18948886263395676 0.60896974751700461 -1.1389241389506868 0.11210504917006106 -0.32567305910012351 0.51740302729359411 -0.093903034156549353 0.98159292524186936 -0.42987918145517939 -0.46601546790016807 0.11999581309741372 0.53894456493421616 0.40818446478324472 0.8876997938367126 -0.092691805927811136 0.033829481082412259;-0.24721955997997969 1.4388079156665272 -0.4042533109340769 0.80367999284123837 0.15253178153923491 1.0627816729418618 0.1247322926025053 1.2645030969333748 -0.1004421925703657 1.0620060537868909 0.70982433593324556 1.9881635748280195 -0.14193630048139411 1.5686113457014752 0.18985880304562328 0.35085119124832992 0.29937817824245683 0.55158534999449249 -0.49746931095387625 1.0806874966577535 -0.24997567745710725 0.61716227452697792 -0.73214827230686708 0.15664862808829377 0.3490817451915082 0.10304084098515662 0.1486874728204432 0.22181442161689344 -0.61535359735033501 -0.66556104702646779 0.06344549099549654 0.010909988039746063 -0.19760095356748011 -0.70060887372865421 -1.0708253184600125 -0.81264655333975588 0.44340988660886677 -0.06643433319420948 -0.052110348835368026 -0.35691587377935891 -0.60886777107240475 -1.1672099901580377 0.044241001697834043 -0.21306745569425789 0.21242629591557102 -0.71195989439627416 -0.54233449295378866 -0.48143782698475562 -0.14722058657359458 -0.30665169605268611 -0.2902523211005178 -1.3514767491440705 -0.075716441783750185 -0.33015916190977973 0.022961627116767885 -0.36597637909576075 0.16333859340524728 -0.73050884236437563 -0.69024055728414668 0.10172345546015542;0.20896902019824776 0.072754661361220732 -0.88517056414224782 -1.0364339445447062 0.2392241512861141 0.0084899560045812728 -0.11872220588972637 -0.48085376765706089 -0.37601821408171326 -1.7727514955978927 0.88726459888374154 -0.97705164487665019 -0.16674178712674748 -0.1080209251664522 -0.32733155899106281 -1.101111612758696 0.51253757459259808 -1.0038666194514818 -0.38472763242450464 -0.23136945538923914 -0.42404992913236639 -0.95270044570219126 -0.27820995476034088 -0.94807827012059154 -0.11663470623788577 -0.45657496550864646 -0.10713977935785995 -0.25419668998757844 -0.76481591386046244 -0.70849777848846951 0.17627309925747478 -0.028285568155168958 0.3490972847859482 -0.22053065861341667 -0.69966534872877595 -0.20429088140198437 0.36090407770958849 0.87593378223118623 0.51310393108404351 0.37845698547092466 -0.69799014546468086 0.23055057410807017 -0.15103912616870913 1.3471829729311942 -0.0038590064815419425 1.3526364843857326 -0.40213558709263408 0.15234592862558144 0.2360320905690805 1.479978048137913 0.084830553391914407 1.4164589686134363 0.43251872518655687 0.14736603745372714 0.19456310432811366 1.086857937963857 0.41851203279947052 0.10460642378156244 0.40824933364553573 -0.5894547210423472;-0.62328336614095159 -0.16345782202097456 -0.34866921385924127 -1.0847102225308216 -0.12868108218833998 -0.11506610958277458 -0.62626571493164462 -0.7893512164216252 -0.035791174648756134 -1.0682932922298514 0.64719753160979954 0.001577617278163091 -0.14303912350361689 -0.95826829499170774 -0.017134312951991106 -0.25108370854121842 0.85755084416140193 -0.48590500398880337 0.11749535231722541 -0.33556368033295358 -0.014492285955461089 1.2107366083356144 0.16062763819767353 -0.11355752172904722 0.26520239521532535 -0.020236708213004211 0.14569413892661867 1.2077003829458837 -0.078337463049116429 0.33351207623893375 0.056324731942502669 -0.061505807421857947 0.1359570527547091 1.1200884071567137 -1.0903901700055294 0.39777415245802195 0.0075375832623365436 0.10959899386848782 0.13093690841020594 1.729225051106587 -0.53347485736365885 -0.2777464276440067 0.12675610940335699 0.64284670028406976 -0.36439676010900524 1.2595358774063927 -1.2589354753141644 -0.77307543208039009 0.68856464508327886 0.46671122190033343 0.32060752767521161 0.66064395285399602 -0.46681384189826247 -0.60356076945990589 0.45003028862843064 1.3375480980137722 0.15874620097353787 -0.097679680023048318 0.085487581682121949 -0.15808947991340078;-0.25624497702672849 -1.009188074382394 0.73847943510905723 -0.59954258090625578 -1.5860599094912067 -0.2998640029873913 0.030233406158512804 -0.86360230179258379 1.1252624898433026 -1.478140232263909 -1.2959728025568937 -1.0392371866436825 0.048105227672119825 -0.55470359062316654 0.68345297127557847 -0.39782245811224975 -0.45618342125141514 -0.12639890884955499 -0.13696420234423989 -0.57617354236397411 -0.13274660528284932 -0.1617058487654289 -0.53693120441183673 -0.5706455898254531 -0.15337333992809254 -0.40054467623372242 -1.0420928641159164 -0.11058093487398574 0.35720649750737143 -0.33743012663906291 0.12465834353060617 0.016881250131439204 -1.3755545015404977 0.69727636279615091 0.18776263649743127 -0.072156239715912535 0.066134213738496664 0.12937063775454266 -0.5307309686638666 0.71177108027937297 0.76364614970304834 -0.047475347196451724 -0.015378851394459173 -0.32893553814649873 -1.1318336534370166 0.28885253449067616 0.80558992158454945 -0.03716445473643594 0.17785795009859448 -0.042034113111616186 -1.0584817743958184 1.0516944761838747 -0.035636146807041386 -0.14059408334729162 -0.024379880090138327 0.24397526392105756 -0.91627123356994766 0.48819594899956903 0.09171033861896985 0.42428608724942712;0.079489644095244311 -0.14591340592610669 2.1034699266236156 0.11922448428996094 -1.6477411135282354 -1.3854264344010254 -0.3936370408058314 -0.39494077608311828 0.98523266084104122 -0.70987521030018763 -2.4594870744131017 -1.1754025248534403 0.031934012345758774 -0.41398420057778645 -0.082469247356332057 0.28555944613277606 -0.7707771988111255 -0.1973224244648038 9.6262847995891776e-05 -0.49791320418843682 -0.26038895612044327 -0.62161652978260984 0.13788099240688997 0.017630289341814352 -0.11916633410562916 -0.20509368975957384 -1.3054371757453753 0.04985681854449335 0.32806634411768798 -0.10656974131900007 0.53188940135472973 0.37526248155289732 -1.426805336184845 -0.23466324771213792 1.1341909602851896 0.16198554207954954 -0.44821433669673061 0.77589179344385861 -1.2162884223051669 0.2362266624725621 0.630726110174189 0.82055327858084259 -0.0028838592114097906 0.64063310789508987 -1.6620585336838942 0.25348486556062272 1.625148565232396 0.043664268548611718 0.5022980174467514 1.2146504553372917 -1.6990539749527844 0.77066481081636806 0.83090747265310438 -0.081485159064625834 0.047417190673565056 1.3571169675080179 -1.7167518658917751 0.77898235643312352 0.32183112737963904 0.24112520082208025;0.47018713909330467 0.091031260393740251 0.0061746753152281987 0.95931422301626101 -0.76933872636233147 -0.19156884998029136 1.0824531673624564 0.01419423490277805 0.018185881521867273 2.06082793848518 -1.040366305775138 0.12167394149550971 1.0400502466760102 0.47860070133521321 0.060286547377405741 0.94163662069700338 -0.69715097587523933 0.31708785761623376 -0.206532415840118 -0.033506803598240327 -0.46586736306007187 0.62024912184707037 0.307980548779132 -0.03729220483987742 -0.31338212317813541 -0.10667313515539463 -0.0095344577154026795 0.48159082515023915 0.64447972075801574 0.03759848191306283 -0.39568205757407071 0.11338169635457494 -0.20119326790497194 -0.64263141734960028 0.51931465243567221 -0.052330795285431851 0.085183334159560448 0.25969777268105104 0.32705899139732059 -0.90631800384288519 0.61475920737228607 -0.0001916739205057561 -0.19178752858275011 -0.011848873818452576 0.5393736962191451 -0.44026205941456553 0.32947366677056644 0.33123861325398424 -0.13824760332173178 -0.31559904247049891 0.10213087462248815 -0.32654647494556227 0.19872766361295202 0.20995224185262579 -0.60989038433405618 -0.19728378488317921 0.28598757655277474 -0.28397062786200156 -0.5104351442491244 0.10969356985474944;0.16327856807288485 0.81377861744350877 -0.55429237784022267 -0.67052469085527056 0.28696696499340646 0.59665754149023476 -0.27368751759826826 0.84299789039141881 -0.35946932731357711 -0.8430117891803407 -0.17741597465854478 0.72415128270854534 0.040775901523503147 0.61249502220806773 -0.27575404287244987 -0.91835654164912961 0.22246009324033139 0.04283910633283667 -0.042116377706793176 0.013152438786361947 -0.26848196098182514 -1.3013929991516608 -0.4349309582091388 -0.064278672701899839 -0.18612268352312913 -0.020317549718699788 -0.053799627092036485 -0.57954424937164217 -0.35011571873162739 -0.28020226367346074 0.42260474516629704 0.037906813001016559 0.09383215091440486 -0.40141094436035119 0.14824501224973821 -0.46929569257903081 -0.17342936095253528 -0.25100712795671887 -0.77788377884812543 -0.4848510265433848 0.15599673225472616 -0.1273607977159304 0.3700097677262944 -0.10973901035986403 -0.18500811774995651 -0.19689239158567085 0.80258342707262831 0.23009799326337049 -0.16488813990013501 -0.53341996449861429 -0.22375457297182916 -0.17554649091198782 0.092734206871158811 -0.038279023160695973 0.23225790444428421 -0.63956860098368351 -0.33176551209316157 0.22822750104822517 0.14646490423714811 0.021962386137451287;0.29506165051544436 -0.48765463767644507 -0.6207029692867303 -1.9002627850763503 -0.98891832016527226 0.13624724540939884 0.33984345834012331 0.050852049735471451 -0.55815918194020953 -2.0304595059604669 -0.58796813874276155 0.18683104297453829 0.025599820040916006 0.21876057769689816 -0.5332146024217207 -1.2507131335213835 0.039190471386336016 -0.044460361585007609 0.15686030736892848 -0.25618360052751588 0.25639355592059171 -1.2364073686978128 -0.094727868450846742 0.29136569867536699 0.10743585728526958 -0.015773738424003998 0.39407534200485367 -0.44457674518527679 0.58943801816743902 -0.36255603396108871 0.10574438285599264 -0.072022501160983049 0.12390324127130763 0.27957071132175476 0.31689121788132785 -0.41981078319450721 -0.051792603431665619 -0.58368372430816418 -0.10855316049174467 0.28494731691328623 0.35207785718064211 -0.69750030028585164 -0.10844660930881656 -0.90193085171005449 0.29928869534490732 0.6284615209776987 -0.48975291620079853 -1.180306554172686 -0.44631181334914077 -0.91094128651241402 -0.13935344458402188 0.71408861293917225 -0.39103915297354996 -0.095209239338022666 -0.31054678313924022 -0.60867286080912031 -0.029073911722165818 0.15053684387128699 -0.031645635937781601 0.18168959496703052;-0.11067603046029198 -0.62676934773894288 1.3780473110242006 -1.881761599849513 -1.135507516700754 0.078939712004043705 0.018664807700159172 -0.24088466062110034 1.403865229711095 -2.8082679406321622 -1.8431136874672978 -0.26158063435452134 -0.16574216645347925 -0.63335015555395036 1.3477151867903698 -0.34806777784167875 -0.27100886897641474 0.10414085895045756 0.35723792571430441 -0.51038625776102453 0.82417430371456968 -1.9258385478593971 -0.11854634073064402 0.0079035306124015485 -0.097070010163707782 0.13001801125045237 0.82139770004868173 -1.431030314584991 0.45067986899438728 -0.086168711801378306 0.34971045497095593 -0.054494029713104332 1.1973933016813614 -0.35500013010892839 0.63473433044897176 -0.36150560751303312 -0.64220087766565803 0.11437866882352694 1.2555435114013473 0.021839628703635264 1.3166177017094838 0.26769024691639537 0.29649804767951871 -0.04874533692905933 1.0328524450511463 0.28994386032581615 1.8651314401324302 0.23354012398577856 -0.077296402586378321 -0.15225009173110321 1.2054434941912304 0.80790174797940939 1.223924991806304 0.20226769322836943 0.048176820906857619 -0.40425819071326324 1.2222821513473254 0.039634851354061883 0.32464828019534481 -0.09396484633384003;0.05006989935405691 0.33917195712750492 1.0702655495908306 0.11219628501986707 0.63042657674265923 0.35553970092210696 0.24087458829797492 0.23547185163537374 0.64949251564270527 -0.05323801994373302 0.45475270163801829 0.34851764574034055 0.38375238642341503 0.22967975804351176 0.72973565430429099 -0.21802680063372026 0.24217645310435629 0.59466877377571536 -0.31121900731697522 0.11046773881714814 0.46631136943567741 -0.1075661224807959 -0.1550778129565292 0.64928112836819696 0.33161182926757377 -0.10591551963885665 0.024714009584077455 0.0086699667127256921 -0.076153545319077962 -0.18131420578458124 0.47721182882336399 0.30331626922560362 -0.20924990447763062 0.22959907231111737 -0.093649248737072949 -0.15908813361860905 -0.14983672313489294 -0.2133494112516138 0.018543310999013862 -0.24313547638532995 0.035789204877959738 0.010274043778254298 -0.24287660016446705 0.27375020232722586 0.10725581712619577 0.073514101827882802 -0.53539961958622251 0.17066523278871476 -0.28715029730556846 0.083971401960871633 -0.035839261090364796 -0.35666575214496277 -0.21505706594600182 0.027150934881569867 0.081607446501947734 0.40573254189778885 -0.23062985172244405 -0.34342021449189658 -0.077684757910600255 -0.22071634363679493;0.054485099415041767 -0.55976079560788061 0.34203512560636962 0.46008955860212492 0.80724837005467487 -0.18241661894034739 -0.17241375037171383 -1.0459699704791983 -0.34571710608130501 -0.096578406016894727 0.63987845286594935 -0.54721539215549508 0.16000802545458506 -0.75605326619917879 0.38300450614670567 -0.054099259346737337 0.36284386247595996 -0.015483991283119046 0.086402886308232729 -0.28621887014890823 0.09506034987481693 0.37608706036722062 0.12157348507237567 0.65178554969705649 -0.069654503512354429 -0.49927453946964045 0.035137884339192939 0.11955717613300017 -0.18455105457942608 0.36575046521450399 0.16348458191599324 -0.81037416182353339 -0.43443009980199765 0.25269808753219158 -0.53498939065933315 -0.18084858118091882 -0.11160622418270398 -1.0106535593095378 0.17638381949397408 0.72171635858811567 -0.35630577392468166 0.13823380301318075 -0.39539544930947373 -0.74652430868966435 -0.28374264389176757 0.63348056030964406 -0.54667663910238451 -0.1745392277217824 -0.19126634004291118 -0.42700615236739281 0.084821204396804142 0.53468256410281034 -0.32365247074175185 -0.61565956089349927 0.20438131027768125 -0.30475055686836178 -0.17481863810679621 0.45408265560956751 0.59538322284439327 0.55706784565566736;-0.021896277143121083 -0.10198067306017544 -0.14370285685676984 -0.46000835383785948 0.087102001592675046 -0.42931856996246698 -0.28228247845367915 -0.21182158316567373 -0.11672177803126171 -0.98452236918014457 -0.0097762479983977846 -0.28556518759870425 -0.11208623124925607 -0.33364927164178276 0.24839224703904966 -0.36773422593852445 0.041820917903940755 -0.18461192242624186 0.62913248090005081 -0.078325295114883592 -0.051556610488081418 -0.28019719451051733 -0.20360798665642316 0.13087305229126586 0.11815503072832444 0.60980700575649516 -0.55395828292029969 -0.065743812380640212 0.69879355470908966 0.37620699106350464 0.33048585613198883 0.72336517150378321 0.25834709401900574 0.17016436925273148 0.49345799124476963 0.26264425704222943 0.09140883114358378 0.39007747891768529 -0.40235480457007039 0.11293180079510436 0.57326157820408108 0.014977281549066617 0.3725047736184518 0.20645686768497579 -0.49708985007713508 0.057327833346069355 0.29500398358505814 0.25399060663076262 0.17688660824031729 0.43103268016620339 -0.070790862605628863 -0.042151309509019137 -0.064585153949361998 0.24771698208433354 -0.049971144917361231 0.21506683938615853 -0.59660052229042038 -0.34192505620468205 -0.4169948970410754 -0.50483778298828286];

% Layer 2
b2 = [0.42747987941925492;-1.3924547122596882;0.64165415522528113;-1.3946320477908509;-1.035472308251957;0.93137570755780386;-1.0341097795057548;1.4454674800713956;0.09342204554544678];
LW2_1 = [0.20406672931526629 -0.38740383829081143 -0.59131269567284162 -2.131929580921526 -2.7905403912298414 0.22817366748991275 -0.29723491717839456 -0.056467868180818274 -1.4001740969817116 -0.47333829468491412 -2.7318003451652406 -1.6163623109104928 2.3873679398294092 -1.374001530195633 -0.013557838346990675 -0.82668504617233618 1.7080775965348589 0.46611249190046439 2.6342777251108251 -0.64782932721761721;0.089219279054350037 3.2694713271399936 -0.58974990644980796 -2.6451193861763445 1.9936066482334573 0.028693083795824383 0.14920829382962297 0.047370957340912789 -1.8789889786752998 3.4029009034508464 2.2300858601936624 1.8928100420329388 1.364678757894813 -1.4539092071767199 -0.2131921069776759 1.804894596059591 3.0698877206700135 -0.013134265120058476 -0.35797172017465828 0.47077901529717631;-0.60630584895440276 -2.6710327257103583 0.083320942817409038 1.8794199134046923 -3.0847635243518647 1.5257359561193196 0.58751894855964037 -0.8628267061181325 0.68476310959320608 -2.2925725127605454 -0.45244509475831018 -1.1271984258728409 1.6569795581967302 0.92537558120901153 -1.3011229893411782 -1.3473150682580819 -1.7250748264939113 0.33011617210276784 -0.40562106329858688 -0.96750634081913089;-2.6254234610093738 0.33251675538884029 -1.4658750822290005 0.5298769069840602 0.7462400264711907 1.6956800885076311 -0.76031454656137065 -0.56681447663127948 -1.6072260418183064 -2.1567932360136011 0.57707466521821527 0.7131902467264476 3.4280398606905949 1.7808847381642292 -0.74600878888330302 0.75402209360126926 1.5536132210818046 -1.3960625901773187 -1.1671850597843174 0.30774814240304882;0.75850991461176087 1.4006448255403965 1.3491996218124498 -1.9579682081707455 -0.6319391977309976 -1.5537207610678032 -1.7582522107540479 1.7486818722267807 0.44100301840628786 -0.74052576626329858 1.4176365290705204 -2.5788346019507546 -2.7198949808583941 0.19102220884802418 -1.345953042760436 -1.2357706492585634 -4.2701661343229871 0.4633980785786419 0.10899748940931063 -0.81158804363925985;0.35364746493104682 0.78240316840746205 0.49818451055939028 2.0674274106165691 3.1015848301469569 -1.71139621443485 2.0242190593048117 1.8691555837756546 -0.59535406092469079 0.76203281503079612 3.0314198069122074 -0.37492799682185324 2.117620214559647 -0.74379989388601853 -1.444750585673712 -1.6952244287631359 -2.1681788635360113 -0.33004471618365039 1.8179487894155493 -1.2267641264916165;-1.9237590120866457 0.9553888786191066 -0.59984018251231419 -1.8271485106642757 0.5233031829038014 2.6130036733104367 -1.7961151538171636 -1.3639229746825086 3.0265352872259017 -0.91381180378680404 -0.15007276794021146 -1.2693754144256886 -0.71058253115485304 -0.15669650344741073 1.1841046802089157 1.0871259374349465 -0.80641785740199867 0.72705023355694409 0.51018861708023933 -1.0602557559068453;2.9240669159320869 -2.532021119757832 0.20219815941044506 1.5097857345238066 2.2996705320048902 -1.0509102266159744 -0.51691404328669166 -0.38974011728307617 1.290694728086663 1.3961256110541713 -0.42118834633731006 3.4942518087376651 -3.5867470228638791 -0.11614374774820452 1.2309628233411689 1.3982462437766636 1.2757496813420754 -1.1001467910527369 -1.8620660209580888 -0.96781627697598216;0.072208766225928422 -0.71427307464504308 0.22856705492648374 -0.77574046450380263 -0.64031431718675391 -1.3415845017976313 1.5096652768317687 0.14401549714822734 -1.1185936523546791 -0.34779271694656161 -1.2455529474464522 0.95554432540855738 -2.3261557729462843 -1.2357325570394582 0.58039051111966378 0.76493555122821988 1.500406126627736 -0.2943798838128085 -1.1805708305187952 1.0524528722374171];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
else
    a = iSoftmaxApplyCPU(n);
end
end
function a = iSoftmaxApplyCPU(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numerator = exp(n);
denominator = sum(numerator,1);
denominator(denominator == 0) = 1;
a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
nmax = max(n,[],1);
numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
denominator = sum(numerator,1);
a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
if (denominator == 0)
    a = numerator;
else
    a = numerator ./ denominator;
end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
